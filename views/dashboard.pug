extends layout

block content
    .dashboard-container
        h2 Welcome, #{user.username}!
        p Select a previous session to continue, or start a new one.

        //- Form to create a session with a name
        .form-container.session-creation-form
            h3 Start New Session
            form(action="/dashboard/sessions", method="POST")
                .form-group
                    label(for="sessionName") Session Name
                    input(type="text", id="sessionName", name="sessionName", placeholder="e.g., I Hate This Quest", required)
                button.btn-primary(type="submit") Create Session

        h3 Previous Sessions
        .session-list
            if sessions.length > 0
                each session in sessions
                    .session-item-wrapper
                        a.session-item(href=`/dashboard/session/${session.id}`)
                            .session-info
                                span.session-name= session.name
                                span.session-date(data-timestamp=session.created_at)
                            span.session-deaths #{session.death_count} Deaths
                        .delete-trigger
                            .session-delete-container
                                form(action=`/dashboard/session/${session.id}/delete`, method="POST", onsubmit="return confirm('Are you sure you want to permanently delete this session and all its rage logs?');")
                                    button.delete-btn(type="submit", title="Delete Session")
                                        span.delete-icon 🗑️
                                        span Delete
            else
                p You have no previous sessions.

        //- NEW: Pagination Controls
        if totalPages > 1
            nav.pagination
                //- Previous Button
                if currentPage > 1
                    a(href=`/dashboard?page=${currentPage - 1}`) &laquo;
                else
                    span.disabled &laquo;

                //- Page Numbers
                - for (let i = 1; i <= totalPages; i++)
                if i === currentPage
                    span.active= i
                else
                    a(href=`/dashboard?page=${i}`)= i

                //- Next Button
                if currentPage < totalPages
                    a(href=`/dashboard?page=${currentPage + 1}`) &raquo;
                else
                    span.disabled &raquo;

    //- Script to format timestamps and handle hover animations
    script.
        document.addEventListener('DOMContentLoaded', () => {
            // Format all timestamps to the user's local time
            document.querySelectorAll('[data-timestamp]').forEach(el => {
                const timestamp = el.getAttribute('data-timestamp');
                if (timestamp) {
                    el.textContent = new Date(timestamp).toLocaleString();
                }
            });

            // JavaScript to handle the hover animations
            document.querySelectorAll('.delete-trigger').forEach(trigger => {
                const wrapper = trigger.closest('.session-item-wrapper');
                if (wrapper) {
                    trigger.addEventListener('mouseenter', () => {
                        wrapper.classList.add('is-deleting');
                    });
                    trigger.addEventListener('mouseleave', () => {
                        wrapper.classList.remove('is-deleting');
                    });
                }
            });
        });